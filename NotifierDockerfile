FROM node:18.16-alpine AS dependencies

WORKDIR /notifier
COPY delta_notifier/package.json delta_notifier/yarn.lock ./
RUN yarn


##
FROM node:18.16-alpine AS build

WORKDIR /notifier
COPY delta_notifier ./
RUN apk add --update --no-cache openssl
RUN yarn install

###
FROM node:18.16-alpine AS deploy

WORKDIR /notifier

ENV NODE_ENV production

COPY delta_notifier ./

EXPOSE 3001

ENV PORT 3001

CMD ["node", "index.js"]
